<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Test - Alexandria's World</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #1a1a1a;
      color: #00ff00;
    }
    .success { color: #00ff00; }
    .error { color: #ff0000; }
    .info { color: #ffaa00; }
    pre {
      background: #000;
      padding: 10px;
      border: 1px solid #333;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>Alexandria's World - Data Loading Test</h1>
  <div id="results"></div>

  <script>
    const results = document.getElementById('results');

    function log(message, type = 'info') {
      const div = document.createElement('div');
      div.className = type;
      div.innerHTML = message;
      results.appendChild(div);
    }

    async function testDataLoad() {
      log('🔍 Testing data load...', 'info');

      try {
        // Test 1: Fetch with relative path (like app.js does)
        log('<br>📁 Test 1: Fetching ./public/data/books.json', 'info');
        const response1 = await fetch('./public/data/books.json?' + Date.now());
        log(`Response status: ${response1.status} ${response1.statusText}`, response1.ok ? 'success' : 'error');

        if (response1.ok) {
          const data = await response1.json();
          log(`✅ Data loaded successfully!`, 'success');
          log(`<pre>Total countries: ${data.totalCountries}\nCountries array length: ${data.countries.length}\nGenerated at: ${data.generatedAt}</pre>`, 'success');

          // Test status breakdown
          const statuses = {};
          data.countries.forEach(c => {
            statuses[c.status] = (statuses[c.status] || 0) + 1;
          });
          log(`<pre>Status breakdown:\n${JSON.stringify(statuses, null, 2)}</pre>`, 'success');

          // Test first country
          log(`<pre>First country sample:\n${JSON.stringify(data.countries[0], null, 2).substring(0, 500)}...</pre>`, 'info');

          // Test filtering (like app.js does)
          const complete = data.countries.filter(c => c.status === 'complete');
          log(`✅ Filtered ${complete.length} complete countries`, 'success');

          const incomplete = data.countries.filter(c => c.status === 'incomplete');
          log(`✅ Filtered ${incomplete.length} incomplete countries`, 'success');

          const empty = data.countries.filter(c => c.status === 'empty');
          log(`✅ Filtered ${empty.length} empty countries`, 'success');

        }
      } catch (error) {
        log(`❌ Error: ${error.message}`, 'error');
        log(`<pre>${error.stack}</pre>`, 'error');
      }

      // Test 2: Check if assets/scripts/app.js loads
      log('<br>📄 Test 2: Checking app.js', 'info');
      try {
        const appResponse = await fetch('./assets/scripts/app.js');
        log(`app.js status: ${appResponse.status} ${appResponse.statusText}`, appResponse.ok ? 'success' : 'error');
      } catch (error) {
        log(`❌ app.js error: ${error.message}`, 'error');
      }

      // Test 3: Check if CSS loads
      log('<br>🎨 Test 3: Checking main.css', 'info');
      try {
        const cssResponse = await fetch('./assets/styles/main.css');
        log(`main.css status: ${cssResponse.status} ${cssResponse.statusText}`, cssResponse.ok ? 'success' : 'error');
      } catch (error) {
        log(`❌ main.css error: ${error.message}`, 'error');
      }
    }

    testDataLoad();
  </script>
</body>
</html>
